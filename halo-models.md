
# Introduction
This page is project tracker to get halo models like llama3, Flux.1, Mistral etc. working on one or more MI3xx using shark/iree.

# Release Goals
- Shark V3.1.0 (Jan 6, 2025) llama3.1 405B sharded across 8 MI300x GPUs performant at level of vLLM PyTorch, Flux.1 dev
- Shark V3.2.0 (Feb 2025) Grok-1 and Mixtral 8x7B performant

# Glossary

TPn: Tensor Parallel using n GPUs where a large tensor is sharded across multiple GPUs using sharktank and scatter/gather to/from GPUs is done in single MLIR

TTFT: Time To First Token (time taken from processing of prompt to first token generated by the prefill stage)

ITL: Average time between each new token generated in decode phase (second token onwards)

# User Instructions
-Read [cookbooks](https://github.com/nod-ai/shark-ai/tree/main/docs/shortfin/llm/user) for user-like inference run instructions.

## Tracy Profiles (nondecomposed)
| Model | Tracy Profile | dump file| Comments|
|-------|---------------|--------|---|
|llama3.1 8B Fp16 prefill TP1| [Tracy Profile](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/llm-dev/llama3_8b/8b_fp16_prefill_unsharded.tracy) | [Dump File](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/llm-dev/llama3_8b/dump_8B_prefill_unsharded.tar.gz) |
|llama3.1 8B Fp16 decode TP1| [Tracy Profile](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/llm-dev/llama3_8b/8b_fp16_decode_unsharded.tracy) | [Dump File](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/llm-dev/llama3_8b/dump_8B_decode_unsharded.tar.gz) |
|llama3.1 8B Fp16 prefill TP8| [Tracy Profile](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/llm-dev/llama3_8b/8b_fp16_prefill_tp8_sharded.tracy) | [Dump File](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/llm-dev/llama3_8b/dump_8B_prefill_tp8_sharded.tar.gz) |
|llama3.1 8B Fp16 decode TP8| [Tracy Profile](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/llm-dev/llama3_8b/8b_fp16_decode_tp8_sharded.tracy) | [Dump File](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/llm-dev/llama3_8b/dump_8B_decode_tp8_sharded.tar.gz) |
|llama3.1 70B Fp16 prefill TP1| [Tracy Profile](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/llm-dev/70b_fp16_prefill_unsharded.tracy) | [Dump File](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/llm-dev/llama3_8b/dump_70B_prefill_unsharded.tar.gz) |
|llama3.1 70B Fp16 decode TP1| [Tracy Profile](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/llm-dev/70b_fp16_decode_unsharded.tracy) | [Dump File](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/llm-dev/llama3_8b/dump_70B_decode_unsharded.tar.gz) |
|llama3.1 405B Fp16 prefill TP8| [Tracy Profile](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/llm-dev/llama3_405b/405b_f16_tp8_nondecomposed_32.tracy) || [Issue 19571](https://github.com/iree-org/iree/issues/19571)

# Testing
- See [Testing Status](https://github.com/nod-ai/llm-dev/blob/main/model_status.md)  
  
# Schedule
(Model is assumed to be llama3.1 in the following table, e.g. "8B FP8" means "llama3.1 8B FP8 model")
|Item                          | Previous Week (Jan 13-17) |  Next Week (Jan 20-24) |
|------------------------------|-----------------------|--------------------------|
| Sharktank Modeling           |  - @Ean get all controlnet pipeline models running (Done 1/14) <br> - @Boian debugging numerics in flux-transformer (ETA 1/16) <br> - @Rob look at padding top matmul in prefill (ETA 1/14) <br> - @Rob multi-device tracing still serial and debugging (Done 1/16) <br> - @Dan Adding fp8 kernel tests (ETA 1/14) <br> - @Dan continuing fp8 70b llama model numeric debugging (ETA 1/24) <br> - @Chi Helping debug fp8 llama compilation (ETA 1/17) | - @ Rob triaging numerical errors in llama (Done 1/20) <br> - @ Rob generating tracy profiles with new multi-device for 405b (ETA 1/20) <br> - @Stephen Verifying latest llama numerics (ETA 1/20) <br> - @ Stephen mlperf harness for llama (ETA 1/24) <br> - @Dan prefill numerics compiling and good with HF rotary embedding, verifying ours now (ETA 1/20) <br> - @Dan fp8 attention llama (ETA 1/23) <br> - @Boian refatctoring flux to use llama rotary embedding from llama (ETA 1/21)
| IREE codegeneration          | |
| Serving | - @Ean Controlnet pipeline functionality in shortfin (Done 1/15) <br> - @Ean Debugging controlnet numerics (ETA 1/16) <br> - @Kyle fixing up shortfin flux support (ETA 1/14) <br> - @Stephen triaging iree compile regression (ETA 1/14) <br> - @Stephen triaging potential shortfin regression with 70b (Done 1/16) <br> - @Archana shortfin PPL debugging (ETA 1/14) <br> - @Xida debugging concurrent request numeric issue (ETA 1/16) <br> - @Jinchen mlperf loadgen integration with shortfin (ETA 1/17) <br> - @Vinayak helping mlperf integration (ETA 1/17) <br> - @Phaneesh flux performance | -  @Jinchen remove extra client connection every request and keep open (1/22) <br> - @Vinayak help event pool client connection issues (ETA 1/21)  <br> - @Archana likely found root cause issue on PPL, working on fix now (ETA 1/20) <br> - @Archana debugging llama regression from masked attention (ETA 1/21)  <br> - @Ean help out on mlperf and client handoff (ETA 1/22) <br> - @Kyle cleanup and refactor flux pipeline (ETA 1/21) <br> - @Phaneesh flux perf burndown (ETA 1/22) 
| Test Automation              | |
| Performance Tuning           | |

# Nightly Test Reports
See latest [CI/Nightly Test Report](https://nod-ai.github.io/shark-ai/). Use [Nod.AI Lab](https://confluence.amd.com/pages/viewpage.action?spaceKey=ENGIT&title=Nod.AI+Lab) page to ssh into machine SharkMi300X to find logs and artifacts to triage the failures. File an issue (if not already filed/listed) and add to Issues table below.

# Issues
| category | issue link | assigned to | status |
|---|---|---|---|
|quark quantization | [QUARK-71](https://jira.xilinx.com/browse/QUARK-71) | Bowen Bow | FP8 matmul should be used in attention |
|shark-sre | N/A | Sai Enduri | Need more systems for CI/dev of 405b |
|runtime | [19812](https://github.com/iree-org/iree/issues/19812) | Stephen Baione | Llama3.1_fp16_8b_tp8 fails prefill for long prompts when using async allocator |
|runtime | [19832](https://github.com/iree-org/iree/issues/19832) | Stephen Baione | Llama_405b_tp8 OOM w/ Long Input Prompt |
|iree runtime python package | [19886](https://github.com/iree-org/iree/issues/19886) | Avinash Sharma | TP8 benchmarking hits segfault with clang-17 |
|iree tracy profiling | [19571](https://github.com/iree-org/iree/issues/19571) | |hits assertion for tracing 405B sharded |

# Status-Numerics
Following naming convention should be used for weights and artifacts (on SharkMI300x and other similar machines)

**UnSharded Weights:**

/data/<model_name>/weights/<model_size>/<modelname_modelsize_datatype>.irpa

Example: /data/llama-3.1/weights/405b/fp16/llama3.1_405b_fp16.irpa

**Sharded Weights:**

```
/data/<model_name>/weights/<model_size>/<shard_size>/<modelname_modelsize_shardsize_ranksuffix>.irpa
```

Example: `/data/llama-3.1/weights/405b/fp16/tp8/llama3.1_405b_fp16_tp8_parameters.rank0.irpa`

**Artifacts:**

```
/data/<model_name>/artifacts/<model_size>/<model_name>\_<model_size>\_<data_type>\_<attention_kind>\_<sharding>\_<batch_size>.[mlir | vmfb]
```

Example: `/data/llama-3.1/artifacts/405b/llama3.1_405b_fp16_nondecomposed_tp8_bs4.mlir`

### Artifacts
(MI300X GPU, SPX Mode)
|Item                                      | Generate MLIR | Compile to vmfb | IREE invocation | IREE numeric | Serving numeric |
|------------------------------------------|---------------|-----------------|-----------------|--------------|-----------------|
| llama3.1-8B-FP16 bs4 TP1 (prefill)     |PASS [mlir_tp1](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/llm-dev/llama3_8b/8b_f16_bs4_tp1_prefill_nondecomposed_stride_32.mlir) [irpa](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/llama3_8b/8b_f16.irpa)  | PASS [compile command](https://github.com/nod-ai/llm-dev/blob/main/llama_benchmarking.md#4-compile-command) | PASS [benchmark command](https://github.com/nod-ai/llm-dev/blob/main/llama_benchmarking.md#5-benchmark-command) [numpy inputs](https://github.com/nod-ai/llm-dev/blob/main/llama_benchmarking.md#3-get-the-numpy-inputs) | tbd | tbd
| llama3.1-8B-FP16 bs4 TP8 (prefill)     |PASS [mlir_tp8](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/llm-dev/llama3_8b/8b_f16_bs4_tp8_nondecomposed_prefill.mlir)  | PASS | PASS | tbd | tbd
| llama3.1-8B-FP16      |PASS [mlir](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/llama3_8b/8b_f16_nondecomposed.mlir)   | Fails in iree, [patch](https://github.com/iree-org/iree/pull/18890) | tbd | tbd | tbd
| llama3.1-70B-FP16      |PASS [mlir](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/llama3_70b/70b_f16_nondecomposed.mlir)   |Fails in iree, [patch](https://github.com/iree-org/iree/pull/18890) | tbd | tbd | tbd
| llama3.1-405B-FP16 bs4 TP8 (prefill) |  PASS [mlir_tp8](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/llm-dev/llama3_405b/405b_instruct_fp16.mlir) | PASS [compile command](https://github.com/nod-ai/llm-dev/blob/main/llama_benchmarking.md#5-compile-sharded-ir) | PASS [benchmark command](https://github.com/nod-ai/llm-dev/blob/main/llama_benchmarking.md#6-benchmark-sharded-vmfb) [numpy inputs](https://github.com/nod-ai/llm-dev/blob/main/llama_benchmarking.md#2-download-sharded-irpa-files) | tbd | tbd
| llama3.1-405B-FP16 bs4 TP8 (decode)  |  PASS | PASS | FAIL (Segfault) | tbd | tbd |
| llama3.1-8B-FP8   |PASS [mlir](https://sharkpublic.blob.core.windows.net/sharkpublic/dan/fp8_prefill.mlir) | yes | tbd | tbd | tbd
| llama3.1-70B-FP8  |ETA: 11/1   | tbd | tbd | tbd | tbd
| llama3.1-405B-FP8 |ETA: 11/5   | tbd | tbd | tbd | tbd
| llama-toy-size-FP32-TP2-CPU | PASS | PASS | tbd | tbd | tbd

## Flux.1 Transformer

### Download
To download all artifacts, MLIR, VMFB, Tracy traces, etc. you would need to get an Azure account key to access the files in the blob container.
Note that this will download the weights as well, which is ~50 GB.
```bash
az storage blob download-batch \
  --destination "." \
  --pattern "flux/transformer/*" \
  --source "halo-models" \
  --account-name "sharkblobs" \
  --account-key <account-key>
```


### Dev variant
|Item              | Generate MLIR | Compile to vmfb | IREE invocation | IREE numeric | Serving numeric |
|------------------|---------------|-----------------|-----------------|--------------|-----------------|
| black-forest-labs bf16 | PASS | PASS  | PASS | PASS | tbd

### Schnell variant
|Item              | Generate MLIR | Compile to vmfb | IREE invocation | IREE numeric | Serving numeric |
|------------------|---------------|-----------------|-----------------|--------------|-----------------|
| black-forest-labs bf16 | PASS | PASS  | PASS | PASS | tbd

Schenll is almost the same as Dev. Dev has a guidance layer and guidance parameter, while Schenll does not.

### Compile command
```bash
iree-compile \
  black-forest-labs--FLUX.1-dev--transformer-single-layer-b16.mlir \
  -o black-forest-labs--FLUX.1-dev--transformer-single-layer-b16-hip.vmfb \
  --iree-hal-target-device=hip \
  --iree-hip-target=gfx942 \
  --iree-opt-const-eval=false \
  --iree-opt-strip-assertions=true \
  --iree-global-opt-propagate-transposes=true \
  --iree-dispatch-creation-enable-fuse-horizontal-contractions=true \
  --iree-dispatch-creation-enable-aggressive-fusion=true \
  --iree-opt-aggressively-propagate-transposes=true \
  --iree-opt-outer-dim-concat=true \
  --iree-vm-target-truncate-unsupported-floats \
  --iree-llvmgpu-enable-prefetch=true \
  --iree-opt-data-tiling=false \
  --iree-codegen-gpu-native-math-precision=true \
  --iree-codegen-llvmgpu-use-vector-distribution \
  --iree-hip-waves-per-eu=2 \
  --iree-execution-model=async-external \
  "--iree-preprocessing-pass-pipeline=builtin.module(iree-preprocessing-transpose-convolution-pipeline,iree-preprocessing-pad-to-intrinsics)"
```

## T5 Encoder (part of Flux.1 dev)

Only the `xxl` variant is actually used in FLUX. The `small` variant is provided for faster iteration if needed.

#### Compile
```shell
iree-compile \
  google__t5_v1_1_xxl_encoder_fp32.mlir \
  --iree-hal-target-device=hip \
  --iree-hip-target=gfx942 \
  -o google__t5_v1_1_xxl_encoder_fp32.vmfb
```

### Run
```shell
iree-run-module \
  --device=hip \
  --module=google__t5_v1_1_xxl_encoder_fp32.vmfb \
  --parameters=model=google__t5_v1_1_xxl_encoder_fp32.irpa \
  --function=forward_bs4 \
  --input=@google__t5_v1_1_xxl_iree_forward_bs4_arg0.npy
```

(MI300X GPU, SPX Mode)
|Item                                      | Generate MLIR | Compile to vmfb | IREE invocation | IREE numeric | Serving numeric |
|------------------------------------------|---------------|-----------------|-----------------|--------------|-----------------|
| t5-v1.1-small-encoder-bf16      |PASS [mlir](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/t5/small/google__t5_v1_1_small_encoder_bf16.mlir) [gguf](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/t5/small/google__t5-v1_1-small_bf16.gguf) [irpa](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/t5/small/google__t5_v1_1_small_encoder_bf16.irpa)  | PASS | PASS [args](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/t5/small/google__t5_v1_1_small_encoder_bf16_iree_forward_bs4_arg0.npy) [expected_result](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/t5/small/google__t5_v1_1_small_encoder_bf16_torch_forward_result0.npy) | FAIL | tbd
| t5-v1.1-xxl-encoder-bf16      |PASS [mlir](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/t5/xxl/google__t5_v1_1_xxl_encoder_bf16.mlir) [gguf](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/t5/xxl/google__t5-v1_1-xxl_bf16.gguf) [irpa](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/t5/xxl/google__t5_v1_1_xxl_encoder_bf16.irpa)  | PASS | PASS [args](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/t5/xxl/google__t5_v1_1_xxl_encoder_bf16_iree_forward_bs4_arg0.npy) [expected_result](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/t5/xxl/google__t5_v1_1_xxl_encoder_bf16_torch_forward_result0.npy) | FAIL | tbd
| t5-v1.1-small-encoder-f32      |PASS [mlir](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/t5/small/google__t5_v1_1_small_encoder_f32.mlir) [gguf](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/t5/small/google__t5-v1_1-small_f32.gguf) [irpa](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/t5/small/google__t5_v1_1_small_encoder_f32.irpa)  | PASS | PASS [args](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/t5/small/google__t5_v1_1_small_encoder_f32_iree_forward_bs4_arg0.npy) [expected_result](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/t5/small/google__t5_v1_1_small_encoder_f32_torch_forward_result0.npy) | PASS `tol < (atol=1e-4, rtol=1.5e-3)` | tbd
| t5-v1.1-xxl-encoder-f32      |PASS [mlir](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/t5/xxl/google__t5_v1_1_xxl_encoder_f32.mlir) [gguf](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/t5/xxl/google__t5-v1_1-xxl_f32.gguf) [irpa](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/t5/xxl/google__t5_v1_1_xxl_encoder_f32.irpa)  | PASS | PASS [args](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/t5/xxl/google__t5_v1_1_xxl_encoder_f32_iree_forward_bs4_arg0.npy) [expected_result](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/t5/xxl/google__t5_v1_1_xxl_encoder_f32_torch_forward_result0.npy) | PASS `tol < (atol=1e-4, rtol=1.5e-3)` | tbd

## Mixtral 8x7B
|Item              | Generate MLIR | Compile to vmfb | IREE invocation | IREE numeric | Serving numeric |
|------------------|---------------|-----------------|-----------------|--------------|-----------------|
| Mixtral 8x7B ONNX   |tbd | tbd | tbd | tbd | tbd


# AMD GPU Machines
[MI300](https://confluence.amd.com/display/ENGIT/Nod.AI+Lab#Nod.AILab-MI300NodAIMachines)


## MLIR generation and Compilation
Generate IR

```shell
python3 -m sharktank.examples.export_paged_llm_v1 \
  --irpa-file <input_irpa path with correct sharding and dtype> --output-mlir <output-mlir> \
  --bs <batch size> --tensor-parallelism-size <TP size if sharding> \
  --attention-kernel <decomposed or torch_sdpa> --no-fake-quant <only for fp8>
```

Generate vmfb

```shell
iree-compile --iree-hal-target-backends=rocm --iree-hip-target=gfx942 -o <output-vmfb path>
```

## Evaluation tests
### Perplexity
Follow the steps [here](https://github.com/nod-ai/SHARK-Platform/blob/main/sharktank/sharktank/evaluate/README.md)

## Accessing sharkblobs on Azure:
In browser, click on [sharkblobs](https://portal.azure.com/#@amdcloud.onmicrosoft.com/resource/subscriptions/8c190d1b-eb91-48d5-bec5-3e7cb7412e6c/resourceGroups/pdue-nod-ai-rg/providers/Microsoft.Storage/storageAccounts/sharkblobs/storagebrowser) , then click on "Blob-containers" and the click on "halo-models"

Or, use command line by first installing az cli as:
```shell
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
```

And then, get the account key for the storage account by clicking on "Storage Accounts" in Azure Services or searching "sharkblobs" in the top search bar. Then, click on sharkblobs. Then, on the left side bar, under Security + networking, click on "Access keys". Copy the account key from here and use in the following command
To upload:

```shell
az storage blob upload --account-name sharkblobs --container-name halo-models --name <azure path, example: halo-models/llama3_8b/tp1/llama.mlir> --file <local_path_on_computer> --account-key <key_retrieved_from_directions_above>
```

To download:

```shell
az storage blob download --account-name sharkblobs --container-name halo-models --name <azure path, example: halo-models/llama3_8b/tp1/llama.mlir> --file <local_path_on_computer> --account-key <key_retrieved_from_directions_above>
```

if you are downloading from "sharkpublic" then replace instructions above by sharkpublic and get your account access key for sharkpublic.
Example:

```shell
az storage blob download --account-name sharkpublic --container-name sharkpublic --name ian/llama8b_f16.gguf \
  --file llama8b_f16.gguf --account-key <key string>
```

## Export With `sharktank` and Server with `shortfin`:

Follow the steps [here](https://github.com/nod-ai/shark-ai/blob/main/docs/shortfin/llm/user/e2e_llama8b_mi300x.md).

## Setup SGLang With Shortfin

Follow the steps [here](https://github.com/nod-ai/shark-ai/blob/main/docs/shortfin/llm/user/shortfin_with_sglang_frontend_language.md)

## SGLang/Shortfin Feature Enablement

| Feature     | Description | Enabled    | Enablement Requirements | Reference(s) |
| ----------- | ----------- | ---------- | ----------------------- | ------------ |
| `gen`       | Generate shortfin completion, given a prompt | Yes | Enabled | [Shortfin Implementation](https://github.com/stbaione/sglang/blob/main/python/sglang/lang/backend/shortfin.py#L47) |
| `streaming` | Stream shortfin completion, given a prompt | Yes | Enabled | [Shortfin Implementation](https://github.com/stbaione/sglang/blob/main/python/sglang/lang/backend/shortfin.py#L68) |
| `run_batch` | Run batch of disjoint requests with continous batching | Yes | Enabled | [Batch Docs](https://sgl-project.github.io/frontend/frontend.html#batching) |
| `fork`      | Launch parallel prompts | Yes | Enabled | [Fork Docs](https://sgl-project.github.io/frontend/frontend.html#parallelism) |
| `choices`   | Given set of choices, generate response based on best log probs | No | Should work with greedy. Needs backend implementation | [Greedy Token Selection](https://sgl-project.github.io/references/choices_methods.html#greedy-token-selection) [OpenAI Implementation](https://github.com/sgl-project/sglang/blob/main/python/sglang/lang/backend/openai.py#L295) |
| `image`     | Pass image as part of multi-modal prompt | No | Multi-Modal not supported by SF | [sgl.image Docs](https://sgl-project.github.io/frontend/frontend.html#multi-modality) |
| `regex`     | Specify regular expression as decoding constraint | No | Only supported for local models | [Regex Docs](https://sgl-project.github.io/frontend/frontend.html#constrained-decoding) |

## SGLang Benchmark Results

The latest benchmark results for the SGLang integration can be found [here](https://amdcloud-my.sharepoint.com/:x:/g/personal/stbaione_amd_com/EX255KFtxHRMqTW8rBQTmuEBkC4hA8PVYpMTgeOtsxiYxQ?e=VajHh4)

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# Archive
## Status (Old)
(Note: Do not update this one)
|Models | compile | inference (SPX mode) | tracy |
|---|---|---|---|
|llama3.1-8b-Q4_1| PASS | prefill (1817 ms), decode (57.3 ms), [commands](https://gist.github.com/aviator19941/f10b5b7a7c3975de4363450b4d7ec68f) | [prefill](https://sharkpublic.blob.core.windows.net/sharkpublic/avi/llama8b_q4_1_prefill_v2.tracy) [decode](https://sharkpublic.blob.core.windows.net/sharkpublic/avi/llama8b_q4_1_decode_v2.tracy) |
|llama3.1-8b-Q4_k| PASS | | |
|llama3.1-70b-Q4_1| PASS | prefill (3543 ms), decode (213 ms), [commands](https://gist.github.com/aviator19941/79ee5afc39c225ec7469030320014fa3) | [prefill](https://sharkpublic.blob.core.windows.net/sharkpublic/avi/llama70b_q4_1_prefill.tracy) [decode](https://sharkpublic.blob.core.windows.net/sharkpublic/avi/llama70b_q4_1_decode.tracy) |
|grok-1-Q4_1| PASS | FAIL, out of memory | [prefill](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/grok-1/grok-1-q4_1-rocm-prefill.tracy) [decode](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/grok-1/grok-1-q4_1-rocm-decode.tracy) |

## Artifacts (Old)
(Note: Update Schedule-Numerics table for llama3.1 artifacts instead of this table (10/20/2024 onwards))
### Guideline:
1) small files and MLIR files check into [llm-dev](https://github.com/nod-ai/llm-dev)
2) large files upload to [sharkblobs](https://portal.azure.com/#@amdcloud.onmicrosoft.com/resource/subscriptions/8c190d1b-eb91-48d5-bec5-3e7cb7412e6c/resourceGroups/pdue-nod-ai-rg/providers/Microsoft.Storage/storageAccounts/sharkblobs/storagebrowser) -> "halo-models" container on Azure and put link to that in the table(s) below
3) Very large files, store on GPU server and note the name/location of/on the machine in table(s) below

Note: If a link to Azure sharkblob below gives you an error, either use az cli to download (see section Accessing sharkblobs on Azure) or click on [sharkblobs](https://portal.azure.com/#@amdcloud.onmicrosoft.com/resource/subscriptions/8c190d1b-eb91-48d5-bec5-3e7cb7412e6c/resourceGroups/pdue-nod-ai-rg/providers/Microsoft.Storage/storageAccounts/sharkblobs/storagebrowser), then click on "Blob containers" and then navigate to the file manually and download it.

### TP1

Models           |     FP16        |   FP8           |     Q4_1         |    Q4_K       |    Attention IRs
:--------------: | :-------------: |:----------------:|:---------------:|:-------------:|:------------------:
llama2-7b | | [irpa](https://sharkblobs.blob.core.windows.net/dan/qdq_full_transpose.irpa) [mlir](https://sharkblobs.blob.core.windows.net/dan/batch_llama_v1.mlir) | | | [Attention IRs](https://github.com/nod-ai/llm-dev/tree/main/models/llama_attention_irs)
llama3-8b | [mlir](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/llama3_8b/llama8b_f16.mlir) [gguf](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/llama3_8b/llama8b_f16.gguf) | [mlir](https://sharkpublic.blob.core.windows.net/sharkpublic/dan/native_fp8_e4m3fnuz_llama3_8b.mlir) [irpa](https://sharkpublic.blob.core.windows.net/sharkpublic/dan/native_fp8_e4m3fnuz_llama3_8b.irpa) | [mlir](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/llama3_8b/llama8b_q4_1.mlir) [gguf](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/llama3_8b/llama8b_q4_1.gguf) | [mlir](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/llama3_8b/llama8b_q4_k.mlir) [gguf](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/llama3_8b/llama8b_Q4_K.gguf) |
llama3-70b | [mlir](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/llama3_70b/llama70b_f16.mlir) [gguf](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/llama3_70b/llama70b_f16.gguf) |  [mlir](https://sharkpublic.blob.core.windows.net/sharkpublic/dan/native_fp8_e4m3fnuz_llama3_70b.mlir) [irpa](https://sharkpublic.blob.core.windows.net/sharkpublic/dan/native_fp8_e4m3fnuz_llama3_8_70b.irpa)| [mlir](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/llama3_70b/llama70b_q4_1.mlir) [gguf](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/llama3_70b/llama70b_q4_1.gguf) | [mlir](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/llama3_70b/llama70b_q4_k.mlir) [gguf](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/llama3_70b/llama70b_q4_k.gguf) |
llama3-405b | [mlir](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/llm-dev/llama3_405b/llama3.1_405b_fp16_TP1.mlir) [gguf](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/llama3_405b/llama405b_fp16.gguf) | | [mlir](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/llama3_405b/llama405b_q4_1.mlir) [gguf](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/llama3_405b/llama405b_q4_1.gguf) | [mlir](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/llama3_405b/llama405b_q4_k.mlir) [gguf](https://sharkblobs.blob.core.windows.net/halo-models/llm-dev/llama3_405b/llama405b_q4_k.gguf) |
grok-1 | [mlir](https://sharkpublic.blob.core.windows.net/sharkpublic/dan/grok.mlir) [gguf](https://sharkpublic.blob.core.windows.net/sharkpublic/llm-dev/grok_1/grok-1-f16.gguf) |NA | [mlir](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/grok-1/grok-1-q4_1-irpa.mlir) [gguf](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/grok-1/grok-1-q4_1.gguf) | [gguf](https://sharkpublic.blob.core.windows.net/sharkpublic/halo-models/grok-1/grok-1-q4_k.gguf) |

